<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>单词热 - 拼写模式</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="tw.build.css">
    <style>
        .wechat-container {
            max-width: 375px;
            margin: 0 auto;
            background: #f7f7f7;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .wechat-statusbar {
            height: 44px;
            background: #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            color: white;
            font-size: 14px;
        }
        .wechat-navbar {
            height: 44px;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            border-bottom: 1px solid #e5e5e5;
        }
        .word-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            animation: slideInDown 0.5s ease-out;
        }
        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .letter-box {
            width: 40px;
            height: 50px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            background: white;
            transition: all 0.3s ease;
        }
        .letter-box.filled {
            border-color: #3b82f6;
            background: #eff6ff;
            color: #1d4ed8;
        }
        .letter-box.correct {
            border-color: #10b981;
            background: #d1fae5;
            color: #047857;
            animation: bounceIn 0.5s ease-out;
        }
        .letter-box.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
            color: #dc2626;
            animation: shake 0.5s ease-in-out;
        }
        .letter-box.current {
            border-color: #f59e0b;
            background: #fef3c7;
            animation: pulse 1s infinite;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
            20%, 40%, 60%, 80% { transform: translateX(3px); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .keyboard-key {
            min-width: 32px;
            height: 40px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .keyboard-key:hover {
            background: #f3f4f6;
            transform: translateY(-1px);
        }
        .keyboard-key:active {
            transform: translateY(0);
            background: #e5e7eb;
        }
        .keyboard-key.used {
            background: #d1d5db;
            color: #6b7280;
            cursor: not-allowed;
        }
        .keyboard-key.correct {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }
        .keyboard-key.incorrect {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }
        .hint-card {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            transform: translateY(10px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        .hint-card.show {
            transform: translateY(0);
            opacity: 1;
        }
        .progress-circle {
            stroke-dasharray: 251.2;
            stroke-dashoffset: 251.2;
            transition: stroke-dashoffset 0.5s ease-in-out;
        }
        .floating-letters {
            position: absolute;
            pointer-events: none;
            animation: floatUp 2s ease-out forwards;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-50px) scale(1.2); }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="wechat-container">
        <!-- 状态栏 -->
        <div class="wechat-statusbar">
            <span>9:41</span>
            <span>拼写模式</span>
            <div class="flex items-center space-x-1">
                <i class="fas fa-signal text-xs"></i>
                <i class="fas fa-wifi text-xs"></i>
                <i class="fas fa-battery-three-quarters text-xs"></i>
            </div>
        </div>

        <!-- 导航栏 -->
        <div class="wechat-navbar">
            <button class="text-gray-600" onclick="safeBack('learning-modes.html')">
                <i class="fas fa-arrow-left text-lg"></i>
            </button>
            <div class="flex items-center space-x-2">
                <span id="libTitle" class="text-sm text-gray-600">中考必备词汇</span>
                <span class="bg-orange-100 text-orange-600 px-2 py-1 rounded-full text-xs" id="progressText">1/20</span>
            </div>
            <button class="text-gray-600" onclick="showHint()">
                <i class="fas fa-lightbulb text-lg"></i>
            </button>
        </div>

        <!-- 进度条 -->
        <div class="px-4 py-3 bg-white border-b border-gray-200">
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-gray-600">拼写进度</span>
                <span class="text-sm font-semibold text-orange-600" id="progressPercent">5%</span>
            </div>
            <div class="progress-brand"><div class="progress-brand-inner transition-all duration-500" style="width:5%" id="progressBar"></div></div>
        </div>

        <!-- 主要内容 -->
        <div class="flex-1 px-4 py-6">
            <!-- 单词卡片 -->
            <div class="text-white rounded-xl p-6 mb-6 text-center brand-gradient">
                <div class="mb-4">
                    <button class="bg-white/20 backdrop-blur-sm rounded-full p-3 mb-4" onclick="playPronunciation()">
                        <i class="fas fa-volume-up text-xl"></i>
                    </button>
                    <p class="text-white/80 text-lg mb-2" id="pronunciation">/ədˈventʃər/</p>
                </div>
                <div class="bg-white/20 backdrop-blur-sm rounded-lg p-4">
                    <p class="text-sm text-white/80 mb-2">中文意思</p>
                    <p class="text-xl font-semibold" id="meaning">冒险；奇遇</p>
                </div>
            </div>

            <!-- 拼写区域 -->
            <div class="bg-white rounded-xl p-6 mb-6 shadow-sm">
                <div class="text-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">请拼写这个单词</h3>
                    <div class="flex justify-center space-x-2 mb-4" id="letterBoxes">
                        <!-- 字母框将通过JavaScript生成 -->
                    </div>
                    <div class="text-sm text-gray-500">
                        <span id="currentPosition">1</span> / <span id="totalLetters">9</span> 个字母
                    </div>
                </div>
            </div>

            <!-- 提示卡片 -->
            <div class="hint-card text-white rounded-xl p-4 mb-6" id="hintCard">
                <div class="flex items-center mb-2">
                    <i class="fas fa-lightbulb mr-2"></i>
                    <span class="font-semibold">记忆提示</span>
                </div>
                <p class="text-sm" id="hintText">ad(向) + venture(冒险) = 向前冒险</p>
            </div>

            <!-- 虚拟键盘 -->
            <div class="bg-white rounded-xl p-4 shadow-sm">
                <div class="space-y-2" id="keyboard">
                    <div class="flex justify-center space-x-1">
                        <button class="keyboard-key" onclick="inputLetter('Q')">Q</button>
                        <button class="keyboard-key" onclick="inputLetter('W')">W</button>
                        <button class="keyboard-key" onclick="inputLetter('E')">E</button>
                        <button class="keyboard-key" onclick="inputLetter('R')">R</button>
                        <button class="keyboard-key" onclick="inputLetter('T')">T</button>
                        <button class="keyboard-key" onclick="inputLetter('Y')">Y</button>
                        <button class="keyboard-key" onclick="inputLetter('U')">U</button>
                        <button class="keyboard-key" onclick="inputLetter('I')">I</button>
                        <button class="keyboard-key" onclick="inputLetter('O')">O</button>
                        <button class="keyboard-key" onclick="inputLetter('P')">P</button>
                    </div>
                    <div class="flex justify-center space-x-1">
                        <button class="keyboard-key" onclick="inputLetter('A')">A</button>
                        <button class="keyboard-key" onclick="inputLetter('S')">S</button>
                        <button class="keyboard-key" onclick="inputLetter('D')">D</button>
                        <button class="keyboard-key" onclick="inputLetter('F')">F</button>
                        <button class="keyboard-key" onclick="inputLetter('G')">G</button>
                        <button class="keyboard-key" onclick="inputLetter('H')">H</button>
                        <button class="keyboard-key" onclick="inputLetter('J')">J</button>
                        <button class="keyboard-key" onclick="inputLetter('K')">K</button>
                        <button class="keyboard-key" onclick="inputLetter('L')">L</button>
                    </div>
                    <div class="flex justify-center space-x-1">
                        <button class="keyboard-key" onclick="inputLetter('Z')">Z</button>
                        <button class="keyboard-key" onclick="inputLetter('X')">X</button>
                        <button class="keyboard-key" onclick="inputLetter('C')">C</button>
                        <button class="keyboard-key" onclick="inputLetter('V')">V</button>
                        <button class="keyboard-key" onclick="inputLetter('B')">B</button>
                        <button class="keyboard-key" onclick="inputLetter('N')">N</button>
                        <button class="keyboard-key" onclick="inputLetter('M')">M</button>
                    </div>
                    <div class="flex justify-center space-x-2">
                        <button class="keyboard-key px-4" onclick="deleteLetter()">
                            <i class="fas fa-backspace"></i>
                        </button>
                        <button class="keyboard-key px-6 bg-blue-500 text-white border-blue-500" onclick="checkSpelling()">
                            检查
                        </button>
                        <button class="keyboard-key px-4" onclick="clearAll()">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 统计信息 -->
        <div class="fixed bottom-4 right-4 bg-white rounded-full p-3 shadow-lg">
            <div class="relative w-12 h-12">
                <svg class="w-12 h-12 transform -rotate-90">
                    <circle cx="24" cy="24" r="20" stroke="#e5e7eb" stroke-width="4" fill="none"></circle>
                    <circle cx="24" cy="24" r="20" stroke="#f59e0b" stroke-width="4" fill="none" 
                            class="progress-circle" stroke-linecap="round" id="statsCircle"></circle>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                    <span class="text-xs font-bold text-orange-600" id="statsNumber">1</span>
                </div>
            </div>
        </div>

        <!-- 结果弹窗 -->
        <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" id="resultModal" style="display: none;">
            <div class="bg-white rounded-xl p-6 mx-4 max-w-sm w-full">
                <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center" id="resultIcon">
                        <i class="fas fa-check text-3xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2" id="resultTitle">拼写正确！</h3>
                    <p class="text-gray-600 mb-4" id="resultMessage">太棒了，继续保持！</p>
                    <div class="bg-gray-50 rounded-lg p-3 mb-4">
                        <p class="text-lg font-bold text-gray-800" id="correctWord">ADVENTURE</p>
                        <p class="text-sm text-gray-600" id="wordMeaning">冒险；奇遇</p>
                    </div>
                    <button class="w-full btn-brand text-white py-3 rounded-xl font-semibold" 
                            onclick="nextWord()">
                        下一个单词
                        <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 查询参数与安全返回
        function getQueryParam(key) {
            const params = new URLSearchParams(window.location.search);
            return params.get(key);
        }
        function safeBack(fallbackUrl) {
            if (document.referrer && document.referrer !== window.location.href) {
                history.back();
            } else {
                window.location.href = fallbackUrl || 'learning-modes.html';
            }
        }
        let currentWordIndex = 0;
        let currentPosition = 0;
        let userInput = [];
        let correctCount = 0;
        let totalWords = 20;

        // 通过 URL 参数设置词库标题与总数
        const libFromUrl = getQueryParam('lib');
        if (libFromUrl) {
            const libTitleEl = document.getElementById('libTitle');
            if (libTitleEl) libTitleEl.textContent = libFromUrl;
        }
        const totalParam = parseInt(getQueryParam('total') || '', 10);
        if (!isNaN(totalParam)) {
            totalWords = totalParam;
            const progressEl = document.getElementById('progressText');
            if (progressEl) progressEl.textContent = `1/${totalWords}`;
        }
        
        const words = [
            {
                word: "ADVENTURE",
                pronunciation: "/ədˈventʃər/",
                meaning: "冒险；奇遇",
                hint: "ad(向) + venture(冒险) = 向前冒险"
            },
            {
                word: "BEAUTIFUL",
                pronunciation: "/ˈbjuːtɪfl/",
                meaning: "美丽的；漂亮的",
                hint: "beauty(美丽) + ful(充满) = 充满美丽的"
            },
            {
                word: "CHALLENGE",
                pronunciation: "/ˈtʃælɪndʒ/",
                meaning: "挑战；质疑",
                hint: "来自法语，原意为'指控'"
            },
            {
                word: "DEVELOP",
                pronunciation: "/dɪˈveləp/",
                meaning: "发展；开发",
                hint: "de(去掉) + velop(包裹) = 去掉包裹，展开发展"
            },
            {
                word: "EDUCATION",
                pronunciation: "/ˌedʒuˈkeɪʃn/",
                meaning: "教育；培养",
                hint: "e(出) + duc(引导) + ation(名词后缀) = 引导出来"
            }
        ];

        function initializeWord() {
            const word = words[currentWordIndex];
            
            // 更新单词信息
            document.getElementById('pronunciation').textContent = word.pronunciation;
            document.getElementById('meaning').textContent = word.meaning;
            document.getElementById('hintText').textContent = word.hint;
            
            // 创建字母框
            const letterBoxes = document.getElementById('letterBoxes');
            letterBoxes.innerHTML = '';
            userInput = [];
            currentPosition = 0;
            
            for (let i = 0; i < word.word.length; i++) {
                const box = document.createElement('div');
                box.className = 'letter-box';
                box.id = `letter-${i}`;
                letterBoxes.appendChild(box);
                userInput.push('');
            }
            
            // 更新当前位置显示
            document.getElementById('totalLetters').textContent = word.word.length;
            updateCurrentPosition();
            
            // 重置键盘
            resetKeyboard();
            
            // 隐藏提示
            document.getElementById('hintCard').classList.remove('show');
        }

        function updateCurrentPosition() {
            document.getElementById('currentPosition').textContent = currentPosition + 1;
            
            // 更新字母框样式
            document.querySelectorAll('.letter-box').forEach((box, index) => {
                box.classList.remove('current');
                if (index === currentPosition) {
                    box.classList.add('current');
                }
            });
        }

        function inputLetter(letter) {
            if (currentPosition >= words[currentWordIndex].word.length) return;
            
            const box = document.getElementById(`letter-${currentPosition}`);
            box.textContent = letter;
            box.classList.add('filled');
            userInput[currentPosition] = letter;
            
            // 添加浮动字母效果
            createFloatingLetter(letter, box);
            
            currentPosition++;
            updateCurrentPosition();
            
            // 标记键盘按键为已使用
            const keyButton = Array.from(document.querySelectorAll('.keyboard-key')).find(btn => btn.textContent === letter);
            if (keyButton) {
                keyButton.classList.add('used');
            }
        }

        function deleteLetter() {
            if (currentPosition <= 0) return;
            
            currentPosition--;
            const box = document.getElementById(`letter-${currentPosition}`);
            const deletedLetter = box.textContent;
            
            box.textContent = '';
            box.classList.remove('filled', 'correct', 'incorrect');
            userInput[currentPosition] = '';
            
            updateCurrentPosition();
            
            // 恢复键盘按键状态
            const keyButton = Array.from(document.querySelectorAll('.keyboard-key')).find(btn => btn.textContent === deletedLetter);
            if (keyButton) {
                keyButton.classList.remove('used');
            }
        }

        function clearAll() {
            for (let i = userInput.length - 1; i >= 0; i--) {
                if (userInput[i]) {
                    currentPosition = i + 1;
                    deleteLetter();
                }
            }
        }

        function checkSpelling() {
            const word = words[currentWordIndex].word;
            const userWord = userInput.join('');
            
            if (userWord.length !== word.length) {
                alert('请完成单词拼写');
                return;
            }
            
            let isCorrect = true;
            
            // 检查每个字母
            for (let i = 0; i < word.length; i++) {
                const box = document.getElementById(`letter-${i}`);
                const keyButton = Array.from(document.querySelectorAll('.keyboard-key')).find(btn => btn.textContent === userInput[i]);
                
                if (userInput[i] === word[i]) {
                    box.classList.add('correct');
                    if (keyButton) keyButton.classList.add('correct');
                } else {
                    box.classList.add('incorrect');
                    if (keyButton) keyButton.classList.add('incorrect');
                    isCorrect = false;
                }
            }
            
            // 显示结果
            setTimeout(() => {
                showResult(isCorrect);
            }, 1000);
        }

        function showResult(isCorrect) {
            const modal = document.getElementById('resultModal');
            const icon = document.getElementById('resultIcon');
            const title = document.getElementById('resultTitle');
            const message = document.getElementById('resultMessage');
            
            if (isCorrect) {
                icon.className = 'w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-green-500';
                icon.innerHTML = '<i class="fas fa-check text-3xl text-white"></i>';
                title.textContent = '拼写正确！';
                message.textContent = '太棒了，继续保持！';
                correctCount++;
            } else {
                icon.className = 'w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-red-500';
                icon.innerHTML = '<i class="fas fa-times text-3xl text-white"></i>';
                title.textContent = '拼写错误';
                message.textContent = '没关系，继续努力！';
            }
            
            const word = words[currentWordIndex];
            document.getElementById('correctWord').textContent = word.word;
            document.getElementById('wordMeaning').textContent = word.meaning;
            
            modal.style.display = 'flex';
        }

        function nextWord() {
            document.getElementById('resultModal').style.display = 'none';
            
            currentWordIndex++;
            
            if (currentWordIndex >= words.length) {
                showFinalResult();
                return;
            }
            
            // 更新进度
            updateProgress();
            
            // 初始化下一个单词
            initializeWord();
        }

        function updateProgress() {
            const progress = ((currentWordIndex + 1) / totalWords) * 100;
            document.getElementById('progressText').textContent = `${currentWordIndex + 1}/${totalWords}`;
            document.getElementById('progressPercent').textContent = `${Math.round(progress)}%`;
            document.getElementById('progressBar').style.width = `${progress}%`;
            
            // 更新圆形进度
            const circle = document.getElementById('statsCircle');
            const circumference = 2 * Math.PI * 20;
            const offset = circumference - (progress / 100) * circumference;
            circle.style.strokeDashoffset = offset;
            
            document.getElementById('statsNumber').textContent = currentWordIndex + 1;
        }

        function showHint() {
            const hintCard = document.getElementById('hintCard');
            hintCard.classList.toggle('show');
        }

        function playPronunciation() {
            const btn = event.currentTarget;
            btn.style.transform = 'scale(0.95)';
            
            // 模拟发音
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(words[currentWordIndex].word);
                utterance.lang = 'en-US';
                speechSynthesis.speak(utterance);
            }
            
            setTimeout(() => {
                btn.style.transform = '';
            }, 200);
        }

        function resetKeyboard() {
            document.querySelectorAll('.keyboard-key').forEach(key => {
                key.classList.remove('used', 'correct', 'incorrect');
            });
        }

        function createFloatingLetter(letter, box) {
            const floating = document.createElement('div');
            floating.className = 'floating-letters text-2xl font-bold text-blue-500';
            floating.textContent = letter;
            floating.style.left = box.offsetLeft + 'px';
            floating.style.top = box.offsetTop + 'px';
            
            box.parentElement.appendChild(floating);
            
            setTimeout(() => {
                floating.remove();
            }, 2000);
        }

        function showFinalResult() {
            const accuracy = Math.round((correctCount / words.length) * 100);
            alert(`拼写练习完成！\n正确率：${accuracy}%\n正确单词：${correctCount}/${words.length}`);
        }

        // 物理键盘支持
        document.addEventListener('keydown', function(e) {
            if (e.key >= 'a' && e.key <= 'z') {
                inputLetter(e.key.toUpperCase());
            } else if (e.key >= 'A' && e.key <= 'Z') {
                inputLetter(e.key);
            } else if (e.key === 'Backspace') {
                e.preventDefault();
                deleteLetter();
            } else if (e.key === 'Enter') {
                e.preventDefault();
                checkSpelling();
            } else if (e.key === 'Escape') {
                clearAll();
            }
        });

        // 初始化
        initializeWord();
        updateProgress();
    </script>
</body>
</html>
